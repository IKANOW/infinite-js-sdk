!function(a){var b=require("angular"),c=require("hashes"),d=require("sprintf"),e=require("lodash"),f=require("moment");a.factory("InfiniteApi",["$q","$http","$log",function(a,d,g){"use strict";function h(){return appConfig.apiBaseDomain}function i(a){return e.indexOf(["GET","POST","PUT","DELETE"],(a+"").toUpperCase())>-1?a:"GET"}function j(a){return e.map(a,function(a){return a.hasOwnProperty&&a.hasOwnProperty("_id")?a._id:a})}function k(){return"MMM d, yyyy hh:mm:ss a"}var l={};return l.dateToMoment=function(a){return e.isString(a)?f(a,k()):f(a)},l.hashPassword=function(a){var b=new c.SHA256;return b.b64(a)},l.idListAsObjects=function(a){return b.isString(a)&&(a=a.split(",")),e.map(a,function(a){return b.isObject(a)?{_id:a._id}:{_id:a}})},l.idListAsString=function(a){return b.isString(a)?a:b.isArray(a)?j(a).join(","):""},l.idListAsArray=function(a){return e.isString(a)?a.split(","):b.isArray(a)?j(a):[]},l.tagListAsString=function(a){return b.isString(a)?a:a.join(",")},l.resolveWithData=function(b){return e.isEmpty(b)?a.reject("Api Response is empty, cannot read data."):b.hasOwnProperty("data")?b.data:a.reject("Api Response does not contain a data object.")},l.resolveWithDataId=function(b){return e.isEmpty(b)?a.reject("Api Response is empty, cannot read data."):b.hasOwnProperty("data")?b.data.hasOwnProperty("_id")?b.data._id:a.reject("Data object does not contain an ID."):a.reject("Api Response does not contain a data object.")},l.resolveWithDataOrArray=function(b){return e.isEmpty(b)?a.reject("Api Response is empty, cannot parse."):b.hasOwnProperty("data")?b.data:[]},l.resolveWithDataOrObject=function(b){return e.isEmpty(b)?a.reject("Api Response is empty, cannot parse."):b.hasOwnProperty("data")?b.data:{}},l.resolveWithResponse=function(b){return e.isEmpty(b)?a.reject("Api Response is empty, cannot read 'response'."):b.response},l.rawQuery=function(c,f,j,k,l,m){var n=a.defer(),o={method:i(c),url:h()+f};return b.isDefined(j)&&(o.params=j),b.isDefined(k)&&(o.data=k),m&&"GET"!=o.method&&(o.headers={"Content-Type":"undefined"==m?void 0:m}),g.debug("[InfiniteApi->rawQuery] HTTP Request:",o),d(o).then(function(a){e.has(a,"data.response")&&a.data.response.success||l===!0?n.resolve(a.data):n.reject(a.data.response.message||"No message from API.")},function(a){n.reject(a)}),n.promise},l.get=function(a,b,c){return l.rawQuery("GET",a,b,null,c)},l.post=function(a,b,c,d,e){return l.rawQuery("POST",a,c,b,d,e)},l.put=function(a,b,c,d,e){return l.rawQuery("PUT",a,c,b,d,e)},l["delete"]=function(a,b,c,d,e){return l.rawQuery("DELETE",a,c,b,d,e)},l}]),a.factory("AuthApiService",["$q","InfiniteApi",function(a,b){"use strict";function c(){return appConfig.apiAuthURI}function e(){return d.sprintf("%s/deactivate",c())}function f(){return d.sprintf("%s/forgotpassword",c())}function g(){return d.sprintf("%s/keepalive",c())}function h(){return d.sprintf("%s/login",c())}function i(a,e){return d.sprintf("%s/admin/%s/%s",c(),encodeURIComponent(a),b.hashPassword(e))}function j(){return d.sprintf("%s/logout",c())}function k(a,d,e,f,g,h){return b.rawQuery(a,c()+d,e,f,g,h)}function l(a,c,d){var f={};return a&&(f.user=a),c&&(f.aduser=c),d&&(f.adpass=b.hashPassword(d)),b.get(e(),f)}function m(a){return a.new_password&&(a.new_password=b.hashPassword(a.new_password)),b.get(f(),a)}function n(){return b.get(g())}function o(a,c,d,e,f,g){var i={username:a,password:b.hashPassword(c)};return d===!0&&(i.return_tmp_key=!0),e===!1&&(i.override=!1),f&&(i.returnurl=f),g===!0&&(i.multi=!0),b.get(h(),i)}function p(a,c){return b.get(i(a,c))}function q(){return b.get(j())}return{rawQuery:k,deactivate:l,forgotPassword:m,keepAlive:n,login:o,loginAdmin:p,logout:q}}]),a.factory("SourceApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiConfigSourceURI}function g(a){return d.sprintf("%s/bad/%s",f(),encodeURIComponent(c.idListAsString(a)))}function h(a){return d.sprintf("%s/good/%s",f(),encodeURIComponent(c.idListAsString(a)))}function i(a){return d.sprintf("%s/pending/%s",f(),encodeURIComponent(c.idListAsString(a)))}function j(a){return d.sprintf("%s/get/%s",f(),encodeURIComponent(a))}function k(a,b){return d.sprintf("%s/delete/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function l(a,b){return d.sprintf("%s/delete/docs/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function m(a){return d.sprintf("%s/save/%s",f(),encodeURIComponent(a))}function n(a,b,c){return c===!0&&(c="true"),c===!1&&(c="false"),d.sprintf("%s/suspend/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),c)}function o(){return d.sprintf("%s/test",f())}function p(){return d.sprintf("%s/user",f())}var q={};return q.rawQuery=function(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)},q.get=function(a){return c.get(j(a))},q.getBad=function(a,d,f){e.isEmpty(a)&&(a="*");var h={stripped:f!==!1};return b.isDefined(d)&&(h.project_id=d),c.get(g(a),{project_id:d})},q.getGood=function(a,d,f){e.isEmpty(a)&&(a="*");var g={stripped:f!==!1};return b.isDefined(d)&&(g.project_id=d),c.get(h(a),g)},q.getPending=function(a,d,f){e.isEmpty(a)&&(a="*");var g={stripped:f!==!1};return b.isDefined(d)&&(g.project_id=d),c.get(i(a),g)},q.getUserSources=function(a,b,d){var e={};return e.communityFilter=a?"true":"false",e.userFilter=b?"true":"false",e.stripped=d?"true":"false",c.get(p(),e)},q.remove=function(a,b){return c.get(k(a,b))},q.removeDocuments=function(a,b){return c.get(l(a,b))},q.save=function(a,b){return c.post(m(a),b)},q.suspend=function(a,b,d){return c.get(n(a,b,d))},q.test=function(a,b,d,e){var f={numReturn:isFinite(a)?a:10,returnFullText:b===!0};return d===!0&&(f.testUpdates=!0),c.post(o(),e,f)},q}]),a.factory("MapReduceApiService",["$q","InfiniteApi",function(a,c){"use strict";function e(){return appConfig.apiCustomMapReduceURI}function f(a,b,c,f){return d.sprintf("%s/%s/%s/%s/%s",e,a,b,c,f)}function g(a){return d.sprintf("%s/getjobs/%s",e(),encodeURIComponent(c.idListAsString(a))).replace(/\/$/,"")}function h(a){return d.sprintf("%s/getresults/%s",e,encodeURIComponent(a))}function i(a){return d.sprintf("%s/removejob/%s",e(),encodeURIComponent(a))}function j(a,b,f,g,h,i,j,k,l,m,n,o,p){return d.sprintf("%s/schedulejob/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s",e(),a,b,encodeURIComponent(c.idListAsString(f)),g,h,i,j,k,l,m,n,o,p)}function k(a,b,f,g,h,i,j,k,l,m,n,o,p,q){return d.sprintf("%s/updatejob/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s/%s",e(),a,b,f,encodeURIComponent(c.idListAsString(g)),h,i,j,k,l,m,n,o,p,q)}function l(a,b,d,f,g,h){return c.rawQuery(a,e()+b,d,f,g,h)}function m(a,b,d,e){return c.get(f(a,b,d,e))}function n(a,d){var e={};return b.isDefined(d)&&(e.project_id=d),c.get(g(a),e)}function o(a,d,e,f){var g={};return b.isString(d)&&(g.find=d),b.isString(e)&&(g.sort=e),b.isNumber(f)&&(g.limit=f),c.get(h(a),g)}function p(a,b){var d={};return b===!0&&(d.removeJar=!0),c.get(i(a),d)}function q(a,b,d,e,f,g,h,i,k,l,m,n,o){return c.get(j(a,b,d,e,f,g,h,i,k,l,m,n,o))}function r(a,b,d,e,f,g,h,i,j,l,m,n,o,p){return c.get(k(a,b,d,e,f,g,h,i,j,l,m,n,o,p))}return{rawQuery:l,run:m,listJobs:n,getResults:o,removeJob:p,scheduleJob:q,updateJob:r}}]),a.factory("SavedQueryApiService",["$q","InfiniteApi",function(a,b){"use strict";function c(){return appConfig.apiCustomSavedQueryURI}function d(a,d,e,f,g,h){return b.rawQuery(a,c()+d,e,f,g,h)}return{rawQuery:d}}]),a.factory("DocumentApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiKnowledgeDocumentURI}function g(a){return d.sprintf("%s/query/%s",f(),encodeURIComponent(c.idListAsString(a)))}function h(a,b){return d.sprintf("%s/file/get/%s/%s",f(),a,b)}function i(a){return d.sprintf("%s/get/%s",f(),encodeURIComponent(a))}function j(a,b){return d.sprintf("%s/get/%s/%s",f(),a,b)}function k(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)}function l(b,d,f){return e.isEmpty(b)?a.reject("Data group IDs are missing. To search all use '*'."):(b=c.idListAsString(b),d&&(f.project_id=d),c.post(g(b),f))}function m(a,b){return c.get(h(a,b))}function n(a,d,e){var f={};return b.isDefined(d)&&(f.returnFullText=d||!1),b.isDefined(e)&&(f.returnRawData=e||!1),c.get(i(a),f)}function o(a,d,e,f){var g={};return b.isDefined(e)&&(g.returnFullText=e||!1),b.isDefined(f)&&(g.returnRawData=f||!1),c.get(j(a,d),g)}return{rawQuery:k,query:l,getFile:m,getDocumentById:n,getDocumentBySourceKey:o}}]),a.factory("FeatureApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiKnowledgeFeatureURI}function g(a,b,e){return d.sprintf("%s/aliasSuggest/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),c.idListAsString(e))}function h(a,e,g,h,i){return b.isString(g)||(g="null"),b.isString(h)||(h="null"),b.isString(i)||(i="null"),d.sprintf("%s/assocSuggest/%s/%s/%s/%s/%s",f(),encodeURIComponent(g),encodeURIComponent(h),encodeURIComponent(i),encodeURIComponent(a),encodeURIComponent(c.idListAsString(e)))}function i(a,b){return d.sprintf("%s/entitySuggest/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(c.idListAsString(b)))}function j(a,b){return d.sprintf("%s/geoSuggest/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(c.idListAsString(b)))}var k={};return k.rawQuery=function(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)},k.aliasSuggest=function(b,d,f){return e.isEmpty(f)?a.reject("Data group IDs are missing. To query all all use '*'."):c.get(g(b,d,f))},k.associationSuggest=function(b,d,f,g,i){return e.isEmpty(d)?a.reject("Data group IDs are missing. To query all use '*'."):c.get(h(b,d,f,g,i))},k.entitySuggest=function(b,d,f,g){if(e.isEmpty(d))return a.reject("Data group IDs are missing. To query all use '*'.");var h={};return(f===!0||f===!1)&&(h.geo=f),(g===!0||g===!1)&&(h.linkdata=g),c.get(i(b,d),h)},k.geoSuggest=function(a,b){return c.get(j(a,b))},k.verbAssociationSuggest=function(a,b,c,d){return k.associationSuggest("verb",a,b,c,d)},k}]),a.factory("CommunityApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiSocialCommunityURI}function g(a,b,e,g){return d.sprintf("%s/add/%s/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),encodeURIComponent(c.tagListAsString(e)),encodeURIComponent(g||"")).replace(/\/$/,"")}function h(a){return d.sprintf("%s/get/%s",f(),encodeURIComponent(a))}function i(){return d.sprintf("%s/getall",f())}function j(){return d.sprintf("%s/getpublic",f())}function k(){return d.sprintf("%s/getprivate",f())}function l(){return d.sprintf("%s/getsystem",f())}function m(a,b){return d.sprintf("%s/member/invite/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(c.idListAsString(b)))}function n(a){return d.sprintf("%s/member/join/%s",f(),encodeURIComponent(a))}function o(a){return d.sprintf("%s/member/leave/%s",f(),encodeURIComponent(a))}function p(a,b){return d.sprintf("%s/member/update/status/%s/$status/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function q(a,b,c){return d.sprintf("%s/member/update/type/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),encodeURIComponent(c))}function r(a){return d.sprintf("%s/remove/%s",f(),encodeURIComponent(a))}function s(a,b){return d.sprintf("%s/requestresponse/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function t(a){return d.sprintf("%s/update/%s",f(),encodeURIComponent(a))}var u={};return u.rawQuery=function(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)},u.add=function(b,d,f,h){return e.isEmpty(f)?a.reject("Cannot create community. Tags are required but empty."):c.get(g(b,d,f,h))},u.getAll=function(a){var d={};return b.isDefined(a)&&(d.project_id=a),c.get(i(),d)},u.get=function(a){return c.get(h(a))},u.getPrivate=function(){return c.get(k())},u.getPublic=function(){return c.get(j())},u.getSystem=function(){return c.get(l())},u.memberInvite=function(a,b,d){var e={};return d===!0&&(e.skipinvitation=!0),c.get(m(a,b),e).then(function(b){return u.get(a)})},u.memberJoin=function(a){return c.get(n(a))},u.memberLeave=function(a){return c.get(o(a))},u.updateMemberStatus=function(b,d,f){return e.find(["active","disabled","pending","remove"],f)?a.reject("Invalid user status, must be ('active'|'disabled'|'pending'|'remove')"):c.get(p(b,f),{status:c.idListAsString(d)}).then(function(a){return DataGroupApiService.get(b)})},u.updateMemberType=function(b,d,f){return e.find(["owner","content_publisher","moderator","member"],f)?a.reject("Invalid member type, must be ('owner'|'content_publisher'|'moderator'|'member')"):c.get(q(b,d,f))},u.remove=function(a){return c.get(r(a))},u.removeMembers=function(a,b){return u.updateMemberStatus(a,b,"remove")},u.requestResponse=function(a,b){return c.get(s(a,b))},u.update=function(b){return b?b._id?c.post(t(b._id),b).then(function(){return b._id}).then(u.get):a.reject("Cannot update a data group without an ID."):a.reject("Community object is empty.")},u.getAllByProjectId=function(a){return u.getAll(a)},u.updateMemberStatusActive=function(a,b){return u.updateMemberStatus(a,b,"active")},u.updateMemberStatusDisabled=function(a,b){return u.updateMemberStatus(a,b,"disabled")},u.updateMemberStatusPending=function(a,b){return u.updateMemberStatus(a,b,"pending")},u.updateMemberStatusRemove=function(a,b){return u.updateMemberStatus(a,b,"remove")},u.updateMemberTypeOwner=function(a,b){return u.updateMemberStatus(a,b,"owner")},u.updateMemberTypeContentPublisher=function(a,b){return u.updateMemberStatus(a,b,"content_publisher")},u.updateMemberTypeModerator=function(a,b){return u.updateMemberStatus(a,b,"moderator")},u.updateMemberTypeMember=function(a,b){return u.updateMemberStatus(a,b,"member")},u}]),a.factory("PersonApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiSocialPersonURI}function g(a){return"me"==a&&(a=null),d.sprintf("%s/get/%s",f(),encodeURIComponent(a||""))}function h(){return d.sprintf("%s/list",f())}function i(){return d.sprintf("%s/register",f())}function j(a){return d.sprintf("%s/delete/%s",f(),encodeURIComponent(a))}function k(){return d.sprintf("%s/update",f())}function l(a,c){return b.isArray(c)&&(c=c.join(",")),d.sprintf("%s/update/email/%s/%s",f(),encodeURIComponent(a),c)}function m(a,b){return d.sprintf("%s/update/password/%s/%s",f(),encodeURIComponent(a),c.hashPassword(b))}var n={};return n.rawQuery=function(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)},n.get=function(a,b){return c.get(g(a),null,b)},n.list=function(){return c.get(h())},n.register=function(a){return e.has(a,"auth.password")&&e.set(a,"auth.password",c.hashPassword(e.get(a,"auth.password"))),c.post(i(),a).then(function(a){var b=a.data;return n.get(b._id)})},n.remove=function(a){return c.get(j(a))},n.update=function(a){return e.has(a,"auth.password")&&e.set(a,"auth.password",c.hashPassword(e.get(a,"auth.password"))),c.post(k(),a)},n.updateEmails=function(a,b){return c.get(l(a,b))},n.updatePassword=function(a,b){return c.get(m(a,b))},n}]),a.factory("ShareApiService",["$q","InfiniteApi",function(a,c){"use strict";function e(){return appConfig.apiSocialShareURI}function f(a,b,c){return d.sprintf("%s/add/community/%s/%s/%s",e(),encodeURIComponent(a),encodeURIComponent(c),encodeURIComponent(b))}function g(a){return d.sprintf("%s/get/%s",e(),encodeURIComponent(a))}function h(a){return d.sprintf("%s/remove/%s",e(),encodeURIComponent(a))}function i(a,b){return d.sprintf("%s/remove/community/%s/%s",e(),encodeURIComponent(a),encodeURIComponent(b))}function j(){return d.sprintf("%s/search",e())}var k={};return k.rawQuery=function(a,b,d,f,g,h){return c.rawQuery(a,e()+b,d,f,g,h)},k.addDataGroupToShare=function(a,b,d,e){var g={};return(e===!0||e===!1)&&(g.readWrite=e),c.get(f(a,b,d),g)},k.create=function(a,d,f,g,h){return c.post(e(),{communities:c.idListAsObjects(a),type:d,title:f,description:g,share:b.isString(h)?h:b.toJson(h)})},k.uploadFile=function(a,b,d,f,g,h){return c.post(e(),g,{communityIds:a,type:b,title:d,description:f},!1,h)},k.get=function(a,b,d,e){var f={};return b===!0&&(f.nocontent=!0),d===!0&&(f.nometa=!0),c.get(g(a),f,e)},k.getFile=function(a){window.open(appConfig.apiBaseDomain+g(a)+"?nometa=true")},k.getFileBase64=function(a){return c.rawQuery("GET",g(a),null,null,!0).then(function(a){return a})},k.remove=function(a){return c.get(h(a))},k.removeDataGroupFromShare=function(a,b){return c.get(i(a,b))},k.search=function(a){return c.get(j(),a).then(function(a){return a.data||(a.data=[]),a})},k.searchByTypes=function(a,b){return search({type:c.idListAsString(type),nometa:b===!0})},k.searchByType=k.searchByTypes,k.searchByGroups=function(a,b,d){var e={searchby:"community",id:c.idListAsString(a),nometa:d===!0};return b&&(e.type=c.idListAsString(b)),search(e)},k.searchByUsers=function(a,b,d){var e={searchby:"person",id:c.idListAsString(a),nometa:d===!0};return b&&(e.type=c.idListAsString(b)),search(e)},k.update=function(a,d,f,g,h,i){return c.put(e(),{_id:a,communities:c.idListAsObjects(d),type:f,title:g,description:h,share:b.isString(i)?i:b.toJson(i)})},k.upsert=function(a,c,d,e,f,g){return b.isString(a)?update(a,c,d,e,f,g):create(c,d,e,f,g)},k.createFromObject=function(a){return create(a.communities,a.type,a.title,a.description,a.share)},k.updateFromObject=function(a){return update(a.id||a._id,a.communities,a.type,a.title,a.description,a.share)},k}]),a.factory("WorkspaceApiService",["$q","$log","InfiniteApi","ShareApiService","CommunityApiService","DataGroupApiService","PersonApiService",function(a,b,c,d,f,g,h){"use strict";function i(a){var b=["workspaceMaster"];return a.isManaged&&b.push("managed"),b}function j(a){if(e.isEmpty(a.dataGroups))return[];var b=[],c=a.dataGroups;return e.isArray(c.groups)?b=c.groups:c.ids&&(b=e.map(c.ids.split(","),function(a){return{_id:a}})),b}function k(b,c){var d=JSON.parse(b.share),f={_id:b._id,created:b.created,dataGroups:j(d),description:b.description,modified:b.modified,title:b.title,workspaceGroupId:d.projectDataGroupId,workspaceUserId:d.workspaceUserId};return a.all({dataGroup:g.get(f.workspaceGroupId),owner:c?a.when(e.find(c,{_id:d.projectOwnerId})):h.get(d.projectOwnerId,!0).then(function(a){return a.data})}).then(function(a){return a.dataGroup.data&&a.owner?(f.members=a.dataGroup.data.members,f.owner={_id:a.owner._id,displayName:a.owner.displayName},f):(console.log("Cannot create workspace from share. Data is missing, access may have changed.",a),null)})["catch"](function(a){return console.error(a),a})}function l(a){var b={ids:c.idListAsString(a.dataGroups)};return{projectOwnerId:a.owner._id,projectDataGroupId:a.workspaceGroupId,dataGroups:b}}function m(a){return{_id:a._id,communities:[a.workspaceGroupId],created:a.created,description:a.description,modified:a.modified,owner:a.owner,share:l(a),title:a.title,type:"infinite_project_config"}}function n(a){return console.log("createWorkspaceGroup",a),g.add("Workspace master group - "+a.title,"ISA workspace master group",i(a)).then(function(a){return a.data.owner={_id:a.data.ownerId,displayName:a.data.ownerDisplayName},a.data}).then(function(b){return a.members?g.memberInvite(b._id,e.filter(a.members,function(a){return a._id!=b.owner._id}),!0).then(function(a){return b._id}):b._id}).then(g.get)}function o(b){return b.workspaceGroupId?d.create(b.workspaceGroupId,"infinite_project_config",b.title,b.description,m(b)).then(function(a){return a.data}):a.reject("Workspace share requires a workspaceDefGroupId")}function p(a){return q.getAll().then(function(b){return b.data=e.find(b.data,{_id:a}),b})}var q={};return q.rawQuery=function(a,b,d,e,f,g){return c.rawQuery(a,_uri_workspaceBase()+b,d,e,f,g)},q.createWorkspace=function(a,b,c,d){var e={title:a,description:b,dataGroups:c,members:d};return n(e).then(function(a){return e.workspaceGroupId=a.data._id,e.owner=a.data.owner,e}).then(function(a){return console.log("Post group-pre share",a),a}).then(o).then(function(a){return e._id=a._id,e.created=a.created,e.modified=a.modified,e})},q.getAll=function(){return b.debug("[WorkspaceApiService.getAll] Fetching all workspaces."),a.all({shares:d.searchByType("infinite_project_config"),people:h.list()}).then(function(b){return a.all(e.map(b.shares.data,function(a){return k(a,b.people.data)}))}).then(function(a){return{response:{action:"Get all workspaces",message:"Workspaces listed successfully",success:!0,time:0},data:e.reject(a,function(a){return null===a})||[]}})},q.update=function(b){return p(b._id).then(c.resolveWithData).then(function(c){var d=e.merge({},c,b),g=e.reject(c.members,{_id:c.owner._id}),h=e.reject(d.members,{_id:c.owner._id}),i=e.differenceBy(h,g,"_id"),j=e.differenceBy(g,h,"_id");return a.all({updatedWorkspace:d,add:i.length>0?f.memberInvite(c.workspaceGroupId,i,!0):null,remove:j.length>0?f.updateMemberStatusRemove(c.workspaceGroupId,j):null})}).then(function(a){return d.updateFromObject(m(a.updatedWorkspace))}).then(c.resolveWithData).then(function(a){return k(a)}).then(function(a){return{response:{success:!0,action:"Workspace",message:"Workspace updated successfully."},data:a}})},q.remove=function(a){return null},q.isNamesValid=function(b){var c={};return e.each(b,function(a){c[a]=!0}),a.when({data:c})},q}]),a.factory("DataGroupApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiSocialDataGroupURI}function g(a,b,e,g){return d.sprintf("%s/add/%s/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),encodeURIComponent(c.tagListAsString(e)),encodeURIComponent(g||"")).replace(/\/$/,"")}function h(a){return d.sprintf("%s/get/%s",f(),encodeURIComponent(a))}function i(){return d.sprintf("%s/getall",f())}function j(){return d.sprintf("%s/getpublic",f())}function k(){return d.sprintf("%s/getprivate",f())}function l(){return d.sprintf("%s/getsystem",f())}function m(a,b){return d.sprintf("%s/member/invite/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(c.idListAsString(b)))}function n(a){return d.sprintf("%s/member/join/%s",f(),encodeURIComponent(a))}function o(a){return d.sprintf("%s/member/leave/%s",f(),encodeURIComponent(a))}function p(a,b){return d.sprintf("%s/member/update/status/%s/$status/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function q(a,b,c){return d.sprintf("%s/member/update/type/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),encodeURIComponent(c))}function r(a){return d.sprintf("%s/remove/%s",f(),encodeURIComponent(a))}function s(a,b){return d.sprintf("%s/requestresponse/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function t(a){return d.sprintf("%s/update/%s",f(),encodeURIComponent(a))}var u={};return u.rawQuery=function(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)},u.add=function(b,d,f,h){return e.isEmpty(f)?a.reject("Cannot create data group. Tags are required but empty."):c.get(g(b,d,f,h))},u.getAll=function(a){var d={};return b.isDefined(a)&&(d.project_id=a),c.get(i(),d).then(function(a){return e.has(a,"data")||(a.data=[]),a})},u.get=function(a){return c.get(h(a))},u.getPrivate=function(){return c.get(k())},u.getPublic=function(){return c.get(j())},u.getSystem=function(){return c.get(l())},u.memberInvite=function(a,b,d){var e={};return d===!0&&(e.skipinvitation=!0),c.get(m(a,b),e).then(function(b){return u.get(a)})},u.memberJoin=function(a){return c.get(n(a))},u.memberLeave=function(a){return c.get(o(a))},u.updateMemberStatus=function(b,d,f){return e.find(["active","disabled","pending","remove"],f)?a.reject("Invalid user status, must be ('active'|'disabled'|'pending'|'remove')"):c.get(p(b,f),{status:c.idListAsString(d)}).then(function(a){return u.get(b)})},u.updateMemberType=function(b,d,f){return e.find(["owner","content_publisher","moderator","member"],f)?a.reject("Invalid member type, must be ('owner'|'content_publisher'|'moderator'|'member')"):c.get(q(b,d,f))},u.remove=function(a,b){return c.get(r(a)).then(function(c){return e.get(c,"response.message","").indexOf("deleted")>-1?c:b!==!0?c:u.remove(a)})},u.removeMembers=function(a,b){return u.updateMemberStatus(a,b,"remove")},u.requestResponse=function(a,b){return c.get(s(a,b))},u.update=function(b){return b?b._id?c.post(t(b._id),b).then(function(){return b._id}).then(u.get):a.reject("Cannot update a data group without an ID."):a.reject("Data group object is empty.")},u.getAllByProjectId=function(a){return u.getAll(a)},u.updateMemberStatusActive=function(a,b){return u.updateMemberStatus(a,b,"active")},u.updateMemberStatusDisabled=function(a,b){return u.updateMemberStatus(a,b,"disabled")},u.updateMemberStatusPending=function(a,b){return u.updateMemberStatus(a,b,"pending")},u.updateMemberStatusRemove=function(a,b){return u.updateMemberStatus(a,b,"remove")},u.updateMemberTypeOwner=function(a,b){return u.updateMemberStatus(a,b,"owner")},u.updateMemberTypeContentPublisher=function(a,b){return u.updateMemberStatus(a,b,"content_publisher")},u.updateMemberTypeModerator=function(a,b){return u.updateMemberStatus(a,b,"moderator")},u.updateMemberTypeMember=function(a,b){return u.updateMemberStatus(a,b,"member")},u}]),a.factory("UserGroupApiService",["$q","InfiniteApi",function(a,c){"use strict";function f(){return appConfig.apiSocialUserGroupURI}function g(a,b,e,g){return d.sprintf("%s/add/%s/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),encodeURIComponent(c.tagListAsString(e)),encodeURIComponent(g||"")).replace(/\/$/,"")}function h(a){return d.sprintf("%s/get/%s",f(),encodeURIComponent(a))}function i(){return d.sprintf("%s/getall",f())}function j(){return d.sprintf("%s/getpublic",f())}function k(){return d.sprintf("%s/getprivate",f())}function l(){return d.sprintf("%s/getsystem",f())}function m(a,b){return d.sprintf("%s/member/invite/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(c.idListAsString(b)))}function n(a){return d.sprintf("%s/member/join/%s",f(),encodeURIComponent(a))}function o(a){return d.sprintf("%s/member/leave/%s",f(),encodeURIComponent(a))}function p(a,b){return d.sprintf("%s/member/update/status/%s/$status/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function q(a,b,c){return d.sprintf("%s/member/update/type/%s/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b),encodeURIComponent(c))}function r(a){return d.sprintf("%s/remove/%s",f(),encodeURIComponent(a))}function s(a,b){return d.sprintf("%s/requestresponse/%s/%s",f(),encodeURIComponent(a),encodeURIComponent(b))}function t(a){return d.sprintf("%s/update/%s",f(),encodeURIComponent(a))}var u={};return u.rawQuery=function(a,b,d,e,g,h){return c.rawQuery(a,f()+b,d,e,g,h)},u.add=function(b,d,f,h){return e.isEmpty(f)?a.reject("Cannot create data group. Tags are required but empty."):c.get(g(b,d,f,h))},u.getAll=function(a){var d={};return b.isDefined(a)&&(d.project_id=a),c.get(i(),d).then(function(a){return e.has(a,"data")||(a.data=[]),a})},u.get=function(a){return c.get(h(a))},u.getPrivate=function(){return c.get(k())},u.getPublic=function(){return c.get(j())},u.getSystem=function(){return c.get(l())},u.memberInvite=function(a,b,d){var e={};return d===!0&&(e.skipinvitation=!0),c.get(m(a,b),e).then(function(b){return u.get(a)})},u.memberJoin=function(a){return c.get(n(a))},u.memberLeave=function(a){return c.get(o(a))},u.updateMemberStatus=function(b,d,f){return e.find(["active","disabled","pending","remove"],f)?a.reject("Invalid user status, must be ('active'|'disabled'|'pending'|'remove')"):c.get(p(b,f),{status:c.idListAsString(d)}).then(function(a){return u.get(b)})},u.updateMemberType=function(b,d,f){return e.find(["owner","content_publisher","moderator","member"],f)?a.reject("Invalid member type, must be ('owner'|'content_publisher'|'moderator'|'member')"):c.get(q(b,d,f))},u.remove=function(a,b){return c.get(r(a)).then(function(c){return e.get(c,"response.message","").indexOf("deleted")>-1?c:b!==!0?c:DataGroupApiService.remove(a)})},u.removeMembers=function(a,b){return u.updateMemberStatus(a,b,"remove")},u.requestResponse=function(a,b){return c.get(s(a,b))},u.update=function(b){return b?b._id?c.post(t(b._id),b).then(function(){return b._id}).then(u.get):a.reject("Cannot update a user group without an ID."):a.reject("User group object is empty.")},u.getAllByProjectId=function(a){return u.getAll(a)},u.updateMemberStatusActive=function(a,b){return u.updateMemberStatus(a,b,"active")},u.updateMemberStatusDisabled=function(a,b){return u.updateMemberStatus(a,b,"disabled")},u.updateMemberStatusPending=function(a,b){return u.updateMemberStatus(a,b,"pending")},u.updateMemberStatusRemove=function(a,b){return u.updateMemberStatus(a,b,"remove")},u.updateMemberTypeOwner=function(a,b){return u.updateMemberStatus(a,b,"owner")},u.updateMemberTypeContentPublisher=function(a,b){return u.updateMemberStatus(a,b,"content_publisher")},u.updateMemberTypeModerator=function(a,b){return u.updateMemberStatus(a,b,"moderator")},u.updateMemberTypeMember=function(a,b){return u.updateMemberStatus(a,b,"member")},u}])}(angular.module("infinite-api",[]));
//# sourceMappingURL=infinite-js-sdk.map